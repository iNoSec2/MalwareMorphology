//Author: Jonathan Johnson

#include <windows.h>
#include <iostream>

int wmain(int argc, wchar_t* argv[])
{
    HANDLE hToken;

    std::wstring GivenUser = argv[1];
    std::wstring UserPassword = argv[2];
    std::wstring delimiter = L"\\";
    std::wstring targetdomainname;
    std::wstring targetusername;

    if (GivenUser.find(delimiter) == std::string::npos) {
	targetdomainname = L".";
        targetusername = GivenUser;
    }
    else {
	targetdomainname = GivenUser.substr(0, GivenUser.find(delimiter));
        targetusername = GivenUser.substr(GivenUser.find(delimiter) + 1, GivenUser.length());
    }

    LogonUser(targetusername.c_str(), targetdomainname.c_str(), UserPassword.c_str(), LOGON32_LOGON_INTERACTIVE, LOGON32_PROVIDER_DEFAULT, &hToken);
    ImpersonateLoggedOnUser(hToken);
           
    CloseHandle(hToken);

    return 0;
}
